<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/png" href="/docs/assets/images/logo-icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Schema - Netpin Documentation</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="docs-container">

        <main class="main-content">
            <h1>Database Schema</h1>
            <p class="lead">
                PostgreSQL database schema reference for the Netpin platform.
            </p>

            <h2>Entity Relationship Diagram</h2>
            <div class="diagram">
                <svg viewBox="0 0 700 500" xmlns="http://www.w3.org/2000/svg">
                    <rect width="700" height="500" fill="#0f172a" />

                    <!-- Users Table -->
                    <rect x="50" y="50" width="150" height="100" rx="4" fill="#1e293b" stroke="#6366f1" />
                    <text x="125" y="75" text-anchor="middle" fill="#6366f1" font-size="12"
                        font-weight="bold">users</text>
                    <text x="60" y="95" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="60" y="110" fill="#94a3b8" font-size="10">email</text>
                    <text x="60" y="125" fill="#94a3b8" font-size="10">password_hash</text>
                    <text x="60" y="140" fill="#94a3b8" font-size="10">name</text>

                    <!-- Projects Table -->
                    <rect x="270" y="50" width="150" height="100" rx="4" fill="#1e293b" stroke="#22c55e" />
                    <text x="345" y="75" text-anchor="middle" fill="#22c55e" font-size="12"
                        font-weight="bold">projects</text>
                    <text x="280" y="95" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="280" y="110" fill="#94a3b8" font-size="10">name</text>
                    <text x="280" y="125" fill="#94a3b8" font-size="10">owner_id (FK‚Üíusers)</text>
                    <text x="280" y="140" fill="#94a3b8" font-size="10">created_at</text>

                    <!-- Clusters Table -->
                    <rect x="490" y="50" width="160" height="130" rx="4" fill="#1e293b" stroke="#3b82f6" />
                    <text x="570" y="75" text-anchor="middle" fill="#3b82f6" font-size="12"
                        font-weight="bold">clusters</text>
                    <text x="500" y="95" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="500" y="110" fill="#94a3b8" font-size="10">name</text>
                    <text x="500" y="125" fill="#94a3b8" font-size="10">project_id (FK)</text>
                    <text x="500" y="140" fill="#94a3b8" font-size="10">provider_id (FK)</text>
                    <text x="500" y="155" fill="#94a3b8" font-size="10">endpoint</text>
                    <text x="500" y="170" fill="#94a3b8" font-size="10">kubeconfig_encrypted</text>

                    <!-- Cloud Providers -->
                    <rect x="490" y="210" width="160" height="100" rx="4" fill="#1e293b" stroke="#f59e0b" />
                    <text x="570" y="235" text-anchor="middle" fill="#f59e0b" font-size="12"
                        font-weight="bold">cloud_providers</text>
                    <text x="500" y="255" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="500" y="270" fill="#94a3b8" font-size="10">type (aws/gcp/azure)</text>
                    <text x="500" y="285" fill="#94a3b8" font-size="10">credentials_encrypted</text>
                    <text x="500" y="300" fill="#94a3b8" font-size="10">owner_id (FK)</text>

                    <!-- Stacks -->
                    <rect x="50" y="210" width="150" height="100" rx="4" fill="#1e293b" stroke="#ec4899" />
                    <text x="125" y="235" text-anchor="middle" fill="#ec4899" font-size="12"
                        font-weight="bold">stacks</text>
                    <text x="60" y="255" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="60" y="270" fill="#94a3b8" font-size="10">name</text>
                    <text x="60" y="285" fill="#94a3b8" font-size="10">project_id (FK)</text>
                    <text x="60" y="300" fill="#94a3b8" font-size="10">selector_json</text>

                    <!-- Findings -->
                    <rect x="270" y="210" width="150" height="120" rx="4" fill="#1e293b" stroke="#ef4444" />
                    <text x="345" y="235" text-anchor="middle" fill="#ef4444" font-size="12"
                        font-weight="bold">findings</text>
                    <text x="280" y="255" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="280" y="270" fill="#94a3b8" font-size="10">project_id (FK)</text>
                    <text x="280" y="285" fill="#94a3b8" font-size="10">stack_id (FK)</text>
                    <text x="280" y="300" fill="#94a3b8" font-size="10">severity</text>
                    <text x="280" y="315" fill="#94a3b8" font-size="10">category</text>

                    <!-- IDI Forecasts -->
                    <rect x="50" y="370" width="150" height="100" rx="4" fill="#1e293b" stroke="#06b6d4" />
                    <text x="125" y="395" text-anchor="middle" fill="#06b6d4" font-size="12"
                        font-weight="bold">idi_forecasts</text>
                    <text x="60" y="415" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="60" y="430" fill="#94a3b8" font-size="10">project_id (FK)</text>
                    <text x="60" y="445" fill="#94a3b8" font-size="10">current_idi</text>
                    <text x="60" y="460" fill="#94a3b8" font-size="10">forecast_7d/14d/30d</text>

                    <!-- Gate Decisions -->
                    <rect x="270" y="370" width="150" height="100" rx="4" fill="#1e293b" stroke="#8b5cf6" />
                    <text x="345" y="395" text-anchor="middle" fill="#8b5cf6" font-size="12"
                        font-weight="bold">gate_decisions</text>
                    <text x="280" y="415" fill="#94a3b8" font-size="10">id (PK)</text>
                    <text x="280" y="430" fill="#94a3b8" font-size="10">project_id (FK)</text>
                    <text x="280" y="445" fill="#94a3b8" font-size="10">decision</text>
                    <text x="280" y="460" fill="#94a3b8" font-size="10">reasons_json</text>

                    <!-- Relationships -->
                    <line x1="200" y1="100" x2="270" y2="100" stroke="#64748b" stroke-width="1" />
                    <line x1="420" y1="100" x2="490" y2="100" stroke="#64748b" stroke-width="1" />
                    <line x1="570" y1="180" x2="570" y2="210" stroke="#64748b" stroke-width="1" />
                    <line x1="345" y1="150" x2="345" y2="210" stroke="#64748b" stroke-width="1" />
                    <line x1="125" y1="150" x2="125" y2="210" stroke="#64748b" stroke-width="1" />
                </svg>
            </div>

            <h2>Core Tables</h2>

            <h3>users</h3>
            <pre><code>CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <h3>projects</h3>
            <pre><code>CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    owner_id UUID REFERENCES users(id),
    created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <h3>clusters</h3>
            <pre><code>CREATE TABLE clusters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    display_name VARCHAR(255),
    project_id UUID REFERENCES projects(id),
    provider_id UUID REFERENCES cloud_providers(id),
    cloud_id VARCHAR(512),
    endpoint VARCHAR(512),
    ca_certificate TEXT,
    region VARCHAR(50),
    kubeconfig_encrypted BYTEA,
    kubeconfig_iv BYTEA,
    status VARCHAR(50) DEFAULT 'unknown',
    created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <h3>findings</h3>
            <pre><code>CREATE TABLE findings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id) NOT NULL,
    cluster_id UUID REFERENCES clusters(id),
    stack_id UUID REFERENCES stacks(id),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    severity VARCHAR(20) NOT NULL,
    category VARCHAR(50) NOT NULL,
    resource_type VARCHAR(100),
    resource_name VARCHAR(255),
    namespace VARCHAR(255),
    remediation TEXT,
    status VARCHAR(20) DEFAULT 'open',
    created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <h2>IDI Tables</h2>

            <h3>idi_forecasts</h3>
            <pre><code>CREATE TABLE idi_forecasts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id) NOT NULL,
    stack_id UUID REFERENCES stacks(id),
    current_idi DECIMAL(5,2),
    forecast_7d DECIMAL(5,2),
    forecast_14d DECIMAL(5,2),
    forecast_30d DECIMAL(5,2),
    days_to_critical INTEGER,
    days_to_high INTEGER,
    trend_direction VARCHAR(20),
    calculated_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <h3>gate_decisions</h3>
            <pre><code>CREATE TABLE gate_decisions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id) NOT NULL,
    stack_id UUID REFERENCES stacks(id),
    decision VARCHAR(20) NOT NULL,
    current_idi DECIMAL(5,2),
    projected_idi DECIMAL(5,2),
    reasons JSONB,
    evaluated_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>

            <div class="alert alert-info">
                <span class="alert-icon">üìÅ</span>
                <div>
                    <strong>Full Schema:</strong> See <code>database/init.sql</code> for the complete database schema.
                </div>
            </div>

        </main>
    </div>
<script src="/docs/assets/js/layout.js"></script></body>

</html>